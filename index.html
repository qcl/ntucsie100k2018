<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>è‡ºå¤§è³‡è¨Šèµ·è–ªç ´ 10 è¬ï¼</title>
    <script>
let deadlineDate = new Date('2018-05-20T12:28:00+08:00');
let exchangeRates = {};
let currencies = {
    'CNY': 'äººæ°‘å¹£ğŸ‡¨ğŸ‡³',
    'HKD': 'æ¸¯å¹£ğŸ‡­ğŸ‡°',
    'USD': 'ç¾å…ƒğŸ’²',
    'JPY': 'æ—¥åœ“ğŸ’´',
    'EUR': 'æ­å…ƒğŸ’¶',
    'SGD': 'æ–°åŠ å¡å…ƒğŸ‡¸ğŸ‡¬',
    'GBP': 'è‹±éŠğŸ’·',
};
let diffTimeString = (startDate, endDate) => {
    let diffTime = endDate - startDate;
    if (diffTime <= 0) {
        return '0ç§’';
    }
    let restSeconds = Math.round(diffTime / 1000);
    let days = Math.round(restSeconds / 86400);

    restSeconds %= 86400;
    let hours = Math.round(restSeconds / 3600);
    
    restSeconds %= 3600;
    let minutes = Math.round(restSeconds / 60);

    restSeconds %= 60;
    let seconds = restSeconds;

    return ` ${days} å¤© ${hours} å°æ™‚ ${minutes} åˆ† ${seconds} ç§’`;
};
let updateCountdownTime = () => {
    let countdownSpan = document.querySelector('span#countdown');
    let couthdownText = diffTimeString(Date.now(), deadlineDate);
    countdownSpan.innerHTML = couthdownText;
};
let sec = 0;
let currentCurrency = 'TWD';
let update = setInterval(function(){
    sec++;
    updateCountdownTime();
    if (sec % 3 == 0 ) {
        updateSalary();
    }
    if (sec % (60 * 5) == 0) {
        updateExchangeRates();
    }
}, 1000);
let updateExchangeRates = () => {
    fetch('https://qcurrency-exchange-rates.appspot.com/api/latest').then(response => { return response.json(); }).then(jsonObj => {
        exchangeRates = jsonObj.rates;
        console.log('exchange rates updated');
    });
};
updateExchangeRates();
let updateSalary = () => {
    let currencyNames = Object.keys(currencies);
    let c = currencyNames.length;
    let rate = 1;
    let baseSalary = 100000;
    let currencyName = 'æ–°è‡ºå¹£ğŸ‡¹ğŸ‡¼';
    while(true) {
        c = Math.round(Math.random() * currencyNames.length);
        if ( c >= currencyNames.length ) {
            if (currentCurrency != 'TWD') {
                currentCurrency = 'TWD';
                currencyName = 'æ–°è‡ºå¹£ğŸ‡¹ğŸ‡¼';
                rate = 1;
                break;
            }
        } else {
            let currency = currencyNames[c];
            if (currency != currentCurrency && exchangeRates[currency] != undefined) {
                currentCurrency = currency;
                currencyName = currencies[currency];
                rate = exchangeRates[currency];
                break;
            }
        }
    }
    let salary = Math.round(baseSalary / rate);
    salaryStr = `${salary} ${currencyName}`;
    let salarySpan = document.querySelector('span#salary');
    salarySpan.innerHTML = salaryStr;
};
    </script>
    <style>
.countdown-area {
    margin-top: 10vh;
    text-align: center;
}

.countdown-area #countdown {
    font-size: 2em;
}

.are-you-100k {
    text-align: center;      
}
    </style>
</head>
<body>
    <div>
        <div class='countdown-area'>
            <p>é‚„æœ‰<span id='countdown'>æ™‚é–“å—ï¼Ÿ<span></p>
        </div>
        <div class='are-you-100k'>
            <h1>ä½ çš„æœˆè–ªç ´ <span id='salary'>100000 æ–°è‡ºå¹£ğŸ‡¹ğŸ‡¼</span>äº†å—ï¼Ÿ</h1>
            <p><a href='http://mrjamie.cc/2015/05/20/cs-crunch/'>ã€Œä¸‰å¹´å…§ï¼Œå°å¤§è³‡å·¥ç•¢æ¥­èµ·è–ªå°‡ç ´å°å¹£ 10 è¬ã€</a>(<a href='https://web.archive.org/web/20150522223407/http://mrjamie.cc/2015/05/20/cs-crunch/'>2015.05.20</a>)</p>
        </div>
    </div>
</body>
</html>

